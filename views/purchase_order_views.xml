<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Vista de formulario para Orden de Servicio -->
    <record id="view_purchase_order_service_form" model="ir.ui.view">
        <field name="name">purchase.order.service.form</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form"/>
        <field name="arch" type="xml">
            
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="is_service_order" invisible="1"/>
                <field name="is_distribution_order" invisible="1"/>
            </xpath>

            <!-- Campos de Orden de Servicio -->
            <xpath expr="//notebook" position="inside">
                <page string="Información de Servicio" invisible="not is_service_order">
                    <group>
                        <group string="Información de Solicitud">
                            <field name="request_area" options="{'no_create': True}"/>
                            <field name="requester_id" options="{'no_create': True}"/>
                            <field name="delivery_date"/>
                            <field name="cancellation_dates"/>
                        </group>
                        <group string="Control de Firmas">
                            <field name="elaborated_by"/>
                            <field name="received_by"/>
                        </group>
                    </group>
                    <group>
                        <group string="Control de Tesorería">
                            <field name="treasury_approval"/>
                            <field name="treasury_approved_by" invisible="not treasury_approval"/>
                        </group>
                        <group string="Conformidad del Servicio">
                            <field name="service_conformity"/>
                            <field name="conformity_signature" invisible="not service_conformity"/>
                            <field name="conformity_date" invisible="not service_conformity"/>
                        </group>
                    </group>
                    <group string="Observaciones de Conformidad" invisible="not service_conformity">
                        <field name="conformity_observations" nolabel="1"/>
                    </group>
                </page>
            </xpath>

            <!-- Campos de Orden de Distribución -->
            <xpath expr="//notebook" position="inside">
                <page string="Información de Distribución" invisible="not is_distribution_order">
                    <group>
                        <group string="Fechas">
                            <field name="scheduled_date"/>
                            <field name="distribution_delivery_date"/>
                        </group>
                        <group string="Tipo de Servicio">
                            <field name="service_type"/>
                            <field name="vehicle_type"/>
                        </group>
                    </group>
                    <group>
                        <group string="Dirección de Recojo">
                            <field name="pickup_address_id" options="{'no_create': True}"/>
                            <field name="pickup_contact_id" options="{'no_create': True}"/>
                            <field name="pickup_phone"/>
                        </group>
                        <group string="Dirección de Entrega">
                            <field name="delivery_address_id" options="{'no_create': True}"/>
                            <field name="delivery_contact_id" options="{'no_create': True}"/>
                            <field name="delivery_phone"/>
                        </group>
                    </group>
                </page>
            </xpath>

            <!-- Líneas para Orden de Distribución -->
            <xpath expr="//field[@name='order_line']/list/field[@name='name']" position="after">
                <field name="is_distribution_line" column_invisible="True"/>
                <field name="route_id" column_invisible="not parent.is_distribution_order" options="{'no_create': True}"/>
                <field name="weight" column_invisible="not parent.is_distribution_order"/>
                <field name="price_per_kg" column_invisible="not parent.is_distribution_order"/>
                <field name="distribution_price" column_invisible="not parent.is_distribution_order"/>
                <field name="volume" column_invisible="not parent.is_distribution_order" optional="hide"/>
                <field name="packaging_type" column_invisible="not parent.is_distribution_order" optional="hide"/>
                <field name="special_handling" column_invisible="not parent.is_distribution_order" optional="hide" widget="boolean_toggle"/>
                <field name="fragile" column_invisible="not parent.is_distribution_order" optional="hide" widget="boolean_toggle"/>
            </xpath>

            <xpath expr="//field[@name='order_line']/form//field[@name='product_qty']" position="after">
                <field name="is_distribution_line" invisible="1"/>
                <field name="route_id" invisible="not parent.is_distribution_order" options="{'no_create': True}"/>
                <field name="weight" invisible="not parent.is_distribution_order"/>
                <field name="price_per_kg" invisible="not parent.is_distribution_order"/>
                <field name="distribution_price" invisible="not parent.is_distribution_order"/>
                <field name="volume" invisible="not parent.is_distribution_order"/>
                <field name="packaging_type" invisible="not parent.is_distribution_order"/>
                <field name="special_handling" invisible="not parent.is_distribution_order"/>
                <field name="fragile" invisible="not parent.is_distribution_order"/>
                <field name="distribution_notes" invisible="not parent.is_distribution_order"/>
            </xpath>

        </field>
    </record>

    <!-- Acción para Órdenes de Servicio -->
    <record id="action_purchase_order_service" model="ir.actions.act_window">
        <field name="name">Órdenes de Servicio</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.order</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="context">{'default_is_service_order': True, 'search_default_is_service_order': 1}</field>
        <field name="domain">[('is_service_order', '=', True)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crear una nueva Orden de Servicio
            </p>
        </field>
    </record>

    <!-- Acción para Órdenes de Distribución -->
    <record id="action_purchase_order_distribution" model="ir.actions.act_window">
        <field name="name">Órdenes de Distribución</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.order</field>
        <field name="view_mode">list,form,kanban</field>
        <field name="context">{'default_is_distribution_order': True, 'search_default_is_distribution_order': 1}</field>
        <field name="domain">[('is_distribution_order', '=', True)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Crear una nueva Orden de Distribución
            </p>
        </field>
    </record>

    <!-- Filtros de búsqueda -->
    <record id="view_purchase_order_filter_inherit" model="ir.ui.view">
        <field name="name">purchase.order.filter.inherit</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='activities_exception']" position="after">
                <separator/>
                <filter string="Órdenes de Servicio" name="is_service_order" domain="[('is_service_order', '=', True)]"/>
                <filter string="Órdenes de Distribución" name="is_distribution_order" domain="[('is_distribution_order', '=', True)]"/>
            </xpath>
        </field>
    </record>

</odoo>